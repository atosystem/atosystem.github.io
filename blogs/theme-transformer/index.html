<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e5cc1a4c9ab1ecffb695.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Baloo+2&display=swap);@import url(https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap);.navbar-module--nav_container--2_Hew{align-items:center;background-color:rgba(255,255,255,.9);display:flex;flex-direction:row;font-family:Baloo\ 2;height:50px;justify-content:space-between;left:0;position:fixed;right:0;top:0;width:100%;z-index:300}.navbar-module--nav_title_container--2b4UX{font-size:30px;margin:10px}.navbar-module--nav_links_container--3ofAj{display:flex;margin:10px}.navbar-module--nav_links--cyTds{color:#000;display:block;margin:10px;padding:.2em 0;position:relative;-webkit-text-decoration-line:none;text-decoration-line:none}.navbar-module--nav_links--cyTds:after{background-color:#680436;bottom:0;content:"";height:.1em;left:0;opacity:0;position:absolute;transition:opacity .3s,-webkit-transform .3s;transition:opacity .3s,transform .3s;transition:opacity .3s,transform .3s,-webkit-transform .3s;width:100%}.navbar-module--nav_links--cyTds:focus:after,.navbar-module--nav_links--cyTds:hover:after{opacity:1;-webkit-transform:translate3d(0,.2em,0);transform:translate3d(0,.2em,0)}.navbar-module--nav_links--cyTds:after{opacity:1;-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:center;transform-origin:center}.navbar-module--nav_links--cyTds:focus:after,.navbar-module--nav_links--cyTds:hover:after{-webkit-transform:scale(1);transform:scale(1)}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;box-sizing:border-box;font:112.5%/1.45em georgia,serif,sans-serif;overflow-y:scroll}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;word-wrap:break-word;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt";background-color:#cecece;color:rgba(0,0,0,.8);font-family:Noto Sans TC,sans-serif;font-kerning:normal;font-weight:400;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help;text-decoration:none}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{text-rendering:optimizeLegibility;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-size:2.25rem;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none;margin:0 0 1.45rem;max-width:100%;padding:0}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace;font-size:1em}figure{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;box-sizing:content-box;height:1px;margin:0 0 calc(1.45rem - 1px);overflow:visible;padding:0}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 0 1.45rem;padding:0}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}*,:after,:before{box-sizing:inherit}h2{font-size:1.62671rem}h2,h3{text-rendering:optimizeLegibility;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0}h3{font-size:1.38316rem}h4{font-size:1rem}h4,h5{text-rendering:optimizeLegibility;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0}h5{font-size:.85028rem}h6{text-rendering:optimizeLegibility;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-size:.78405rem;font-weight:700;line-height:1.1}h6,hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,p{padding:0}dd,dl,p,pre{margin:0 0 1.45rem}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;overflow:auto;padding:1.45rem}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;margin:0 0 1.45rem;padding:0;width:100%}blockquote{margin:0 1.45rem 1.45rem;padding:0}address,form,iframe,noscript{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}td,th,thead{text-align:left}td,th{font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.body_container{align-content:center;background-color:rgba(255,255,255,.9);display:flex;flex-direction:column;justify-content:center;margin:auto;opacity:100%;padding:20px;width:93%}.body_container>*{background-color:transparent}@media (max-width:640px){.body_container{width:100%}}.about-module--div_maker_exp--2EOg8,.about-module--div_music_exp--2fKQB{align-content:"space-between";display:"flex";justify-content:"space-between"}.index-module--blog_item_card--3uDke{margin:10px;-webkit-text-decoration-line:none;text-decoration-line:none}.index-module--blog_item_card--3uDke>Chip{opacity:.5}.index-module--blog_item_card_container--1oKxe{display:flex;flex-direction:column}.index-module--profolio_container--1yRd0{align-content:space-between;display:flex;justify-content:space-between}.index-module--profolio_left--2Syre{flex-basis:35%;flex-shrink:1;text-align:center}.index-module--profolio_left_content--2lJHE{align-content:center;display:flex;flex-direction:column;justify-content:flex-start;margin-top:10%;text-align:center}.index-module--profolio_right--2NWMG{flex-basis:65%;flex-shrink:1}.index-module--profolio_right_content--2BeMZ{margin-top:10%}.index-module--head_image_cropper--l-uox{border-radius:50%;margin-left:auto;margin-right:auto;overflow:hidden;width:50%}.index-module--outter_links_container--19qkh{align-content:flex-start;display:flex;flex-direction:column;font-size:medium;justify-content:flex-start;margin-left:auto;margin-right:auto;text-align:left}.index-module--outter_links_div--ipQfr{align-items:center;display:flex;flex-direction:row;margin-top:2px}.index-module--outter_links_div--ipQfr a{align-items:center;color:#000;display:flex;justify-content:center;text-decoration:none}.index-module--outter_links_div--ipQfr div{margin-left:5px}.index-module--outter_links_div--ipQfr a div:hover{text-decoration:underline}.index-module--section_div--2gkkm{display:flex}.index-module--section_div--2gkkm h3{margin-right:3px}.index-module--name_div--3YSBD{margin-bottom:5px;margin-top:5px}.index-module--name_div--3YSBD .index-module--fordesktop--sVOHS{display:block}.index-module--name_div--3YSBD .index-module--formobile--tBASA{display:none}.index-module--blog_li--2SIpW>:first-of-type{display:block}.index-module--blog_li--2SIpW>:nth-of-type(2){display:none}@media (max-width:640px){.index-module--name_div--3YSBD .index-module--fordesktop--sVOHS,.index-module--outter_links_div--ipQfr a div{display:none}.index-module--name_div--3YSBD .index-module--formobile--tBASA{display:block}.index-module--blog_li--2SIpW>:first-of-type{display:none}.index-module--blog_li--2SIpW>:nth-of-type(2){display:block}}</style><meta name="generator" content="Gatsby 3.9.1"/><title data-react-helmet="true">Blogs-Theme Transformer | Ian Shih</title><meta data-react-helmet="true" name="description" content="Ian Shih 施貽仁"/><meta data-react-helmet="true" property="og:title" content="Blogs-Theme Transformer"/><meta data-react-helmet="true" property="og:description" content="Ian Shih 施貽仁"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@yijenshih"/><meta data-react-helmet="true" name="twitter:title" content="Blogs-Theme Transformer"/><meta data-react-helmet="true" name="twitter:description" content="Ian Shih 施貽仁"/><style data-styled="" data-styled-version="5.3.0"></style><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-64bc8deb61a769723e1b.js"/><link as="script" rel="preload" href="/framework-410e4c663067f1239d60.js"/><link as="script" rel="preload" href="/app-27220bf0ef2fe091df5d.js"/><link as="script" rel="preload" href="/commons-4dcf3db6fd009895484c.js"/><link as="script" rel="preload" href="/36d7c21d1e4b7fa3fc10cf7859aa9fac2846a677-d9991990319625a2a358.js"/><link as="script" rel="preload" href="/9e6ea4d975805858d07c04bb43dd1fddf394f5b1-3246283d6dfbf0f66aa5.js"/><link as="script" rel="preload" href="/component---src-templates-blog-details-js-f2168dd8bd2ba68b4d80.js"/><link as="fetch" rel="preload" href="/page-data/blogs/theme-transformer/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2366270877.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3151475382.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="gbi-1681571932-vSLLmy9GNfJAojvPXnRZTL" style="background-position:center;background-repeat:no-repeat;background-size:cover;position:fixed;height:100%;width:100%;opacity:0.99"><style>
          .gbi-1681571932-vSLLmy9GNfJAojvPXnRZTL:before,
          .gbi-1681571932-vSLLmy9GNfJAojvPXnRZTL:after {
            content: '';
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            
            transition: opacity 0.5s ease 250ms;
            background-position: center;
background-repeat: no-repeat;
background-size: cover;

          }
          .gbi-1681571932-vSLLmy9GNfJAojvPXnRZTL:before {
            z-index: -100;
            
            
            opacity: 1; 
          }
          .gbi-1681571932-vSLLmy9GNfJAojvPXnRZTL:after {
            z-index: -101;
            
            
            
          }
        </style><noscript><style>
    .gbi-1681571932-vSLLmy9GNfJAojvPXnRZTL:before {
      opacity: 1;
      background-image: url('/static/ac0c2d2668a020e56521452232cfd890/14b42/mountains.jpg');
    }</style></noscript><div class="navbar-module--nav_container--2_Hew"><div class="navbar-module--nav_title_container--2b4UX"><a style="text-decoration-line:none;color:black" href="/">Ian Shih</a> </div><div class="navbar-module--nav_links_container--3ofAj"><div><a class="navbar-module--nav_links--cyTds" href="/">Home</a></div><div><a class="navbar-module--nav_links--cyTds" href="/about">About</a></div><div><a class="navbar-module--nav_links--cyTds" href="/cv">CV</a></div><div><a class="navbar-module--nav_links--cyTds" href="/blog">Blog</a></div></div></div><div style="padding-top:80px;position:fixed;overflow-y:scroll;top:0;left:0;right:0;bottom:0"><div class="body_container"><main><h2>Blogs-Theme Transformer</h2><div><div></div><div><h1>Theme Transformer: Symbolic Music Generation with Theme-Conditioned Transformer</h1>
<!-- <img height="600px" src="./model_overall.png"></img> -->
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 31.901840490797547%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAD2EAAA9hAHVrK90AAAB1ElEQVQY0wXBW2vTUAAA4FMm+Cd88tEXf4Hgu3sXhIEPwryAIHsT/4P4WOiE9VHYdHW4iZat7VzaXI5pmkuba5vkJG2Sk9Mk7WrajeP3AYoNQAOmguDpVij93lp5vUqrhYBpY3CzWd8nhDApJv0mxxRXIiTlquQdx4aO48CpnUS6Ni5+se3Mdt30pty8BJsZd4cWIgjFUxCpLUDpKyAMkucdfvZUUoy3c5LKSYTFS/aCsgKzxnguyrrj6aaJTMktFcGi5+0utSx0vVmXu+B2ygI6u9r2hEZzKjbqeYSexWGmRSEZp2l2SfKci2MsKgOmVCRuMScZJPMMBiiQzH7v2lMh9WWeTm1nVa43uyDQTj5g7cd5wB8fco3qe0Mf7IUzcjYeBx9Jgg+wN9GLJOZS19I1oWe4nscts6wrQ8hbUEVOt782/sClyknEVOU3YBEw1IQtqnSa7FH962NB9V50+14VAHB3pMk7uiDQieUl9mD0z1aMZV4s1CSJJ2MXRbM4821RuZ0o+qLI8xDH8TswGZ691pT23l/hYvtL4+e9k+/8g+NvnUcAgIooCQ9V06oP7aCm6f5nzfD351n+CQV+VR6ODoaWvz8yUW1oomqW57WyLJ/8B6QLe/O8nd0DAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="model overall"
        title="model overall"
        src="/static/c255a24843f1197686c9494c890cceab/a6d36/model_overall.png"
        srcset="/static/c255a24843f1197686c9494c890cceab/222b7/model_overall.png 163w,
/static/c255a24843f1197686c9494c890cceab/ff46a/model_overall.png 325w,
/static/c255a24843f1197686c9494c890cceab/a6d36/model_overall.png 650w,
/static/c255a24843f1197686c9494c890cceab/e548f/model_overall.png 975w,
/static/c255a24843f1197686c9494c890cceab/3c492/model_overall.png 1300w,
/static/c255a24843f1197686c9494c890cceab/b3c88/model_overall.png 8756w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<h1>Demo</h1>
<ul>
<li>
<p>Given Theme</p>
<p>
		<audio
			src=/theme-transformer-audio/899_Theme.mp3
			preload="auto"
			
			
			
			controls
      width="undefined"
		></audio>
	</p>
</li>
<li>
<p>Generated music</p>
<table>
<thead>
<tr>
<th>Prompt-based</th>
<th>Theme-based</th>
</tr>
</thead>
<tbody>
<tr>
<td>
		<audio
			src=/theme-transformer-audio/899_Baseline.mp3
			preload="auto"
			
			
			
			controls
      width="undefined"
		></audio>
	</td>
<td>
		<audio
			src=/theme-transformer-audio/899_ThemeTransformer.mp3
			preload="auto"
			
			
			
			controls
      width="undefined"
		></audio>
	</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>(For more demo, go to <a href="https://atosystem.github.io/ThemeTransformer/#demo">demo page</a>)</p>
<h2>Links</h2>
<ul>
<li><a href="https://atosystem.github.io/ThemeTransformer/">Demo page</a></li>
<li><a href="https://atosystem.github.io/ThemeTransformer/code">Code instruction</a></li>
<li><a href="https://atosystem.github.io/ThemeTransformer/cite">Cite our work!</a></li>
<li><a href="https://github.com/atosystem/ThemeTransformer">Github repo</a></li>
</ul>
<h2>Why Theme-Conditioned?</h2>
<p>Let's first examine the way human compose music.</p>
<h3>Motivic Development</h3>
<p>In Music Theory, there is a term called <em>Motivic Development</em>, which is a method for composer to <em>develop</em> a <em>motif</em> into an entire music piece or song. As the spirit of Motivic Development, composer first come up with a <em>motif</em>, and then they employ this musical material with adequate <em>variations</em> to preform <em>development</em> throughout the music piece.</p>
<ul>
<li>
<p>Motif</p>
<p>Motif is a short musical phrase mainifesting a music idea. A common example is the first four notes in the Beethoven's Fifth Symphony, which provides the motif of the first movement.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.331288343558285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7NAAAOzQFj5uSaAAABWklEQVQoz1VR6crCQAzs+z+PYH8oeKIWilbrfdSzrdp6oqKiIzPSD7/AsMluks1MjMfjgTAMMZlMsFqtMJvN0Gg04DgOttstdrsdaO/3W7hcLsLr9RJo+/0ep9NJvmGaJvL5PLLZLGzbxmg0QiaTUdzpdPRBEAQYDAbyi8WiwJj36/Uaw+EQi8VCvpFOp9FutwUmccrxeKzG3W4X8/lcidPpVHfNZvMvv9frqREZ8YzjGEYyamKcKrk7Ho94Pp+ier1e/+WRNuXiGUWRckT5drvJoR7Ukj+7rqvGpMSmfGMhi0iPk1K3xHzfx/l8/jbM5XKo1WooFAoolUqo1+uwLAuVSkX0SHm5XIoeUS6X9cal9ft9ycMa6suBDGpD7arVqjZNMIEF1JDTcNvUiDEX12q11Iwx6TL2PO+r4a8um81Gj6lUSjRI9Vc7vpMNh6C2lIM4HA643++i/AEGTUqlkmVIHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="The motif of the Beethoven&#39;s Fifth Symphony"
        title="The motif of the Beethoven&#39;s Fifth Symphony"
        src="/static/530971ca454926160c9fe4bc7a11143c/07484/Beethoven_5Symphony.png"
        srcset="/static/530971ca454926160c9fe4bc7a11143c/222b7/Beethoven_5Symphony.png 163w,
/static/530971ca454926160c9fe4bc7a11143c/ff46a/Beethoven_5Symphony.png 325w,
/static/530971ca454926160c9fe4bc7a11143c/07484/Beethoven_5Symphony.png 540w"
        sizes="(max-width: 540px) 100vw, 540px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>Motif often lefts strong impression on audience by its constantly recurring appeareance. As in this example, these four notes might be the most memorable melody in this symphony to the public.</p>
</li>
<li>
<p>Variations</p>
<p>For variations, there are several common techniques, including pitch shifting, time reversing, horizontal mirroring and so on.</p>
</li>
<li>
<p>Development</p>
<p>In literature, a compelling story or movie must consist of a structure of development. The same idea works in music too. However, in music, the development can be expressed in many ways, such as arrangement of instruments, variation of motif, complexity of melody etc.</p>
</li>
</ul>
<blockquote>
<p>In additional to <strong>motif</strong>, we use the term <strong>Theme</strong> in this work, regarding the fact that <strong>Motifs</strong> are considered to be shorter and more basic. However, the distinction between theme and motifis not always drawn rigorously. <strong>Themes</strong> also manifest itself throughout the music via variations.</p>
</blockquote>
<p>Even for modern music genre, most of them comply with this song writing mindset, as human brains tends to process structureness and repitions eaiser, which also render <em>repition</em> and <em>structureness</em> essential in music.</p>
<h2>Music Generation</h2>
<p>After having a glimpse of music writing by human, let's see how machine does it.</p>
<p>In recent years, with the advanced of deep learning networks, many previous works use Transformer nertwork to model music pieces in an autoregressive manner.
That is, make the machine to predict the next note given all the previous generated notes.
Along with the powerful attention mechanism, Transformer models have the ability to generate good quality music if given abundant and clean music datasets. Nonetheless, the music generated sounds somehow random in the sense of direction.
The main culprit is that transformer model fail to learn <strong>repition</strong> from massive data. (It could to some extent learn to repeat local patterns, but fail to reuse the musical theme again.) To tackle this problem, we think that perhaps we should teach transformer models the way human compose a song. That is, we should apply <strong>Theme</strong> information into transformer models.</p>
<h2>Methodology</h2>
<h3>Melody Contrastive Clustering</h3>
<p>In our work, we trained an embedding model for melody clustering via contrastive loss.
For contrastive learning, we consider the following 3 augmentation techniques:</p>
<ul>
<li>
<p>Pitch shift on scale</p>
<p>Keep the same contour of a melody but shift them according to their positions in the musicalscale. Note that it is different from uniformly shifting thepitches, because the distances between two adjacent notesare not equal in a Western heptatonic scale (i.e., there arewhole steps and half steps)</p>
</li>
<li>
<p>Last note duration variation</p>
<p>Randomly vary the durationof the last note in the melody</p>
</li>
<li>
<p>Note splitting and combination</p>
<p>Randomly pick a notein the melody and split it into two notes with the samepitch but half of the original duration each; or randomlycombining two neighboring notes with the same pitch.</p>
</li>
</ul>
<p>Within these augmentation techniques are considered positve samples for contrastive learning.</p>
<p>After training the embedding model, we conduct DBScan clustering algorithm on the melody embeddings and search for the largest cluster.</p>
<p>Here is an example of the melody embedding distance visualization.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 39.263803680981596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3AUH/8QAFhAAAwAAAAAAAAAAAAAAAAAAABAh/9oACAEBAAEFAiL/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAADAQEAAAAAAAAAAAAAAAAAASExQf/aAAgBAQABPyG9VFWkP//aAAwDAQACAAMAAAAQcA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAgEFAAAAAAAAAAAAAAABABExIUFhcYH/2gAIAQEAAT8QNA9hgwWTPEDZR5P/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="plot 899"
        title="plot 899"
        src="/static/561af5f7fdf23bee89e708c6d82cbb74/6aca1/plot_899.jpg"
        srcset="/static/561af5f7fdf23bee89e708c6d82cbb74/d2f63/plot_899.jpg 163w,
/static/561af5f7fdf23bee89e708c6d82cbb74/c989d/plot_899.jpg 325w,
/static/561af5f7fdf23bee89e708c6d82cbb74/6aca1/plot_899.jpg 650w,
/static/561af5f7fdf23bee89e708c6d82cbb74/7c09c/plot_899.jpg 975w,
/static/561af5f7fdf23bee89e708c6d82cbb74/01ab0/plot_899.jpg 1300w,
/static/561af5f7fdf23bee89e708c6d82cbb74/d55cf/plot_899.jpg 3999w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span>
For more figures, click <a href="https://atosystem.github.io/ThemeTransformer/#figures">here</a></p>
<h3>Theme Transformer</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 67.48466257668711%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB7md9RpIf/8QAFxABAAMAAAAAAAAAAAAAAAAAAAEQQv/aAAgBAQABBQK5af/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAQADAQEAAAAAAAAAAAAAAAEAESExkf/aAAgBAQABPyFzVPI07cOdj2pQ8wK5P//aAAwDAQACAAMAAAAQ5A//xAAXEQADAQAAAAAAAAAAAAAAAAABEBFB/9oACAEDAQE/EBNX/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAMAAgMAAAAAAAAAAAAAAQARITGRQWGB/9oACAEBAAE/EC/DXBpQoYXV3qOCgmOkNgY8eOoAoAep/9k='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Theme transformer decoder"
        title="Theme transformer decoder"
        src="/static/96d8ef4a11ecf345bc7dd926d45ef163/6aca1/modelC.jpg"
        srcset="/static/96d8ef4a11ecf345bc7dd926d45ef163/d2f63/modelC.jpg 163w,
/static/96d8ef4a11ecf345bc7dd926d45ef163/c989d/modelC.jpg 325w,
/static/96d8ef4a11ecf345bc7dd926d45ef163/6aca1/modelC.jpg 650w,
/static/96d8ef4a11ecf345bc7dd926d45ef163/7c09c/modelC.jpg 975w,
/static/96d8ef4a11ecf345bc7dd926d45ef163/01ab0/modelC.jpg 1300w,
/static/96d8ef4a11ecf345bc7dd926d45ef163/7b6f2/modelC.jpg 8162w"
        sizes="(max-width: 650px) 100vw, 650px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>The core idea of <strong>Theme Transformer</strong> is to utilize two memory network. One for recording the past generated music content, the other one for the theme condition. This is done by utilizing parallel cross and self attention modules with gating mechanism. The theme condition is given at the encoder side, hence cross attention can be viewed as the module for considering the <em>theme</em> and self attention is for considering all the previous generated music content. Together, they formed a two memory network architecture.</p>
<h2>Feel you free to contact me!</h2>
<!--
## Demo
| ID| Theme | Real Data | Baseline | Theme Transformer
| -- | -------- | -------- | -------- | -------- |
| 875 | `audio: /theme-transformer-audio/875_Theme.mp3` | `audio: /theme-transformer-audio/875_Realdata.mp3` | `audio: /theme-transformer-audio/875_Baseline.mp3` | `audio: /theme-transformer-audio/875_ThemeTransformer.mp3`|
| 888 | `audio: /theme-transformer-audio/888_Theme.mp3` | `audio: /theme-transformer-audio/888_Realdata.mp3` | `audio: /theme-transformer-audio/888_Baseline.mp3` | `audio: /theme-transformer-audio/888_ThemeTransformer.mp3`|
| 890 | `audio: /theme-transformer-audio/890_Theme.mp3` | `audio: /theme-transformer-audio/890_Realdata.mp3` | `audio: /theme-transformer-audio/890_Baseline.mp3` | `audio: /theme-transformer-audio/890_ThemeTransformer.mp3`|
| 893 | `audio: /theme-transformer-audio/893_Theme.mp3` | `audio: /theme-transformer-audio/893_Realdata.mp3` | `audio: /theme-transformer-audio/893_Baseline.mp3` | `audio: /theme-transformer-audio/893_ThemeTransformer.mp3`|
| 899 | `audio: /theme-transformer-audio/899_Theme.mp3` | `audio: /theme-transformer-audio/899_Realdata.mp3` | `audio: /theme-transformer-audio/899_Baseline.mp3` | `audio: /theme-transformer-audio/899_ThemeTransformer.mp3`|
| 900 | `audio: /theme-transformer-audio/900_Theme.mp3` | `audio: /theme-transformer-audio/900_Realdata.mp3` | `audio: /theme-transformer-audio/900_Baseline.mp3` | `audio: /theme-transformer-audio/900_ThemeTransformer.mp3`|
| 901 | `audio: /theme-transformer-audio/901_Theme.mp3` | `audio: /theme-transformer-audio/901_Realdata.mp3` | `audio: /theme-transformer-audio/901_Baseline.mp3` | `audio: /theme-transformer-audio/901_ThemeTransformer.mp3`|
| 904 | `audio: /theme-transformer-audio/904_Theme.mp3` | `audio: /theme-transformer-audio/904_Realdata.mp3` | `audio: /theme-transformer-audio/904_Baseline.mp3` | `audio: /theme-transformer-audio/904_ThemeTransformer.mp3`|
| 908 | `audio: /theme-transformer-audio/908_Theme.mp3` | `audio: /theme-transformer-audio/908_Realdata.mp3` | `audio: /theme-transformer-audio/908_Baseline.mp3` | `audio: /theme-transformer-audio/908_ThemeTransformer.mp3`|
| 909 | `audio: /theme-transformer-audio/909_Theme.mp3` | `audio: /theme-transformer-audio/909_Realdata.mp3` | `audio: /theme-transformer-audio/909_Baseline.mp3` | `audio: /theme-transformer-audio/909_ThemeTransformer.mp3`|


## Figures
|#id| First 24 bars  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   | Melody Embedding Distance|
| ------ | -------- | -------- |
|875| <img src="testdata_24bars_modelC/test_875_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_875_front24.jpg" width="100%"/> |
|888| <img src="testdata_24bars_modelC/test_888_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_888_front24.jpg" width="100%"/> |
|890| <img src="testdata_24bars_modelC/test_890_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_890_front24.jpg" width="100%"/> |
|893| <img src="testdata_24bars_modelC/test_893_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_893_front24.jpg" width="100%"/> |
|894| <img src="testdata_24bars_modelC/test_894_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_894_front24.jpg" width="100%"/> |
|896| <img src="testdata_24bars_modelC/test_896_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_896_front24.jpg" width="100%"/> |
|899| <img src="testdata_24bars_modelC/test_899_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_899_front24.jpg" width="100%"/> |
|900| <img src="testdata_24bars_modelC/test_900_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_900_front24.jpg" width="100%"/> |
|901| <img src="testdata_24bars_modelC/test_901_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_901_front24.jpg" width="100%"/> |
|904| <img src="testdata_24bars_modelC/test_904_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_904_front24.jpg" width="100%"/> |
|908| <img src="testdata_24bars_modelC/test_908_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_908_front24.jpg" width="100%"/> |
|909| <img src="testdata_24bars_modelC/test_909_front24.jpg" width="100%"/> | <img src="testdata_24bars_modelC/test_909_front24.jpg" width="100%"/> |  --></div></div></main><footer style="margin-top:2rem;text-align:center">© <!-- -->2022<!-- -->,<!-- -->By Ian Shih</footer></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blogs/theme-transformer";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-72b219bae196683411be.js"],"app":["/app-27220bf0ef2fe091df5d.js"],"component---src-pages-404-js":["/component---src-pages-404-js-bd885b4e4be9e3e69c71.js"],"component---src-pages-about-js":["/component---src-pages-about-js-f1a614aea39e8c18eaa9.js"],"component---src-pages-blog-index-js":["/component---src-pages-blog-index-js-f5cb3b0cb8abcd2d683c.js"],"component---src-pages-cv-js":["/component---src-pages-cv-js-a387e6b0d90775182cf9.js"],"component---src-pages-index-js":["/component---src-pages-index-js-889583cb5cdc9a75d36a.js"],"component---src-pages-survey-en-js":["/component---src-pages-survey-en-js-875a336fe6765571bb94.js"],"component---src-pages-survey-js":["/component---src-pages-survey-js-6c5c4fbd1b04d862da9b.js"],"component---src-pages-tags-index-js":["/component---src-pages-tags-index-js-ca32dc70d611be7a9741.js"],"component---src-templates-blog-details-js":["/component---src-templates-blog-details-js-f2168dd8bd2ba68b4d80.js"],"component---src-templates-blog-tags-js":["/component---src-templates-blog-tags-js-99be52fe00b74b94fa62.js"]};/*]]>*/</script><script src="/polyfill-72b219bae196683411be.js" nomodule=""></script><script src="/component---src-templates-blog-details-js-f2168dd8bd2ba68b4d80.js" async=""></script><script src="/9e6ea4d975805858d07c04bb43dd1fddf394f5b1-3246283d6dfbf0f66aa5.js" async=""></script><script src="/36d7c21d1e4b7fa3fc10cf7859aa9fac2846a677-d9991990319625a2a358.js" async=""></script><script src="/commons-4dcf3db6fd009895484c.js" async=""></script><script src="/app-27220bf0ef2fe091df5d.js" async=""></script><script src="/framework-410e4c663067f1239d60.js" async=""></script><script src="/webpack-runtime-64bc8deb61a769723e1b.js" async=""></script></body></html>